---
title: DApp = D + App
tags:
  - DApp
categories: 
  - 区块链
date: 2020-03-18
---

### DApp

> David Johnston提出DApp应具备代码开源，激励机制，去中心化共识和无单点故障的四个要素。

DApp是Decentralized Application的缩写，代表去中心化应用，是一种运行在计算机P2P网络而不是单个计算机上的应用程序。

* DApp必须是完全开源的，且能够自主运行，任何个体都能够查看应用的代码层；
* DApp必须具备完整的激励机制，使用Token或其它公链Token（必须根据固定的算法生成），以利于对网络贡献者进行奖励，但大部分的Token不能被少数实体所控制；
* DApp可以根据社区提议和市场反馈调整其内部协议，但对所有更改必须通过用户的共识后才能实施；
* DApp的数据和操作记录必须以加密的方式存储在去中心化的区块链网络中，以避免出现单点故障，数据遗失

<!-- more -->

DApp的本质是智能合约。DApp的数据交互由部署在区块链上的智能合约完成，普通App的数据交互由中心化或者分布式的服务器完成。

### 智能合约

智能合约由Nick Szabo（1994）提出，是一种知性合同条款的计算机化的交易协议。目前已经有很多区块链平台可以支持智能合约，其中最大的一个平台就是以太坊（Ethereum）。

#### 智能合约的工作原理

**构建$\rightarrow$存储$\rightarrow$执行**：多方用户共同参与制定一份智能合约；合约通过P2P网络扩散并存入区块链；区块链构建的智能合约自动执行。

1. 智能合约由区块链内的多个用户共同参与制定，可用于用户之间的任何交易行为。协议中明确了双方的权利和义务，开发人员将这些权利和义务以电子化的方式进行编程，代码中包含会触发合约自动执行的条件；

    **共同制定智能合约的步骤**：

    * 首先用户必须先注册成为区块链的用户，区块链会返回给用户一对公钥和私钥；公钥作为用户在区块链上的账户地址，私钥作为操作该账户的唯一钥匙；
    * 两个以及两个以上的用户根据需要，共同商定了一份承诺，承诺中包含了双方的权利和义务；参与者分别用各自私钥进行签名，以确保合约的有效性；
    * 签名后的智能合约，会根据其中的承诺内容，传入到区块链网络中；

2. 一旦编码完成，一旦编码完成，这份智能合约就会被上传到区块链网络上，即全网验证节点都会接收到这份智能合约；

3. 智能合约会定期检查是否存在相关事件和触发条件；满足条件的事件将会被推送到待验证的队列中；

4. 区块链上的验证节点先对该事件进行签名验证，以确保其有效性；等大多数验证节点对该事件达成共识后，智能合约将成功执行，并通知用户；

    **合约通过P2P网络扩散并存入区块链的步骤**：

    * 通过P2P的方式在区块链中全网扩散，每个节点都会收到；区块链中的验证节点会将收到的合约先保存到内存中，等待新一轮的共识时间，触发对该份合约的共识和处理；

    * 当共识时间到了，验证节点会把最近一段时间内保存的所有合约，一起打包成一个合约集合，并计算出这个合约集合的Hash值，最后将这个Hash值组装成一个区块结构并扩散到全网；其它验证节点收到这个区块结构后，会把里面包含的合约集合的Hash取出来，与自己保存的合约集合进行比较；同时发送一份自己认可的集合给其它验证节点；通过这种多次的发送和比较，所有的验证节点最终会在规定的时间内对最新的合约结合达成一致；

    * 最新达成的合约集合会以区块的形式扩散到全网，每个区块包含以下信息：

        * 当前区块的Hash值
        * 前一区块的Hash值
        * 达成共识时的时间戳

        收到合约集的节点，都会对每条合约进行验证，验证通过的合约才会最终写入到区块链中，验证的内容主要是**合约参与者的私钥签名是否与账户匹配**。

5. 成功执行的合约将移出区块。而未执行的合约则继续等待下一轮处理，直至成功执行。   

#### 将智能合约部署到区块链的流程

编写`solidity`代码（.sol）后，需要先将程序代码编译成EVM（Ethereum Virtual Machine）能理解的`Contract ByteCode`，才能部署到Ethereum的区块链上执行。部署到区块链上的合约会有一个和钱包地址（地址）一样格式的合约地址（Contract Address）。

![](https://raw.githubusercontent.com/HurleyJames/ImageHosting/master/Snipaste_2020-03-21_23-09-55.png)

部署后智能合约可自动执行。后续呼叫智能合约时，使用者可以使用部署合约的地址，或者根据编写的智能合约条件，让其它地址也能呼叫这个只能合约。所谓的**呼叫智能合约**，其实就是向这个合约地址发起交易，除了交易代币以外还可以是智能合约提供的呼叫方法。

![](https://raw.githubusercontent.com/HurleyJames/ImageHosting/master/Snipaste_2020-03-21_23-09-55.png)

### 以太坊

#### 概念

> 以太坊是一个运行着智能合约的分布式平台：应用程序完全按照程序运行，不存在故障、审查、欺诈或第三方干预的可能性。

以太坊（Ethereum），简称ETH。是一个通用的全球性区块链，属于公有链；以太坊是一个可编程的、图灵完备的区块链开发平台，相当于一个中心化的全球计算机。以太坊具有用来构建和发布分布式应用的脚本语言，也就是智能合约的编程语言。以太坊这个平台给予了我们使用区块链技术来验证我们运行的代码的执行情况的能力。

在以太坊中，智能合约是可以处理资金的脚本。

#### 以太坊虚拟机EVM

在一个编程系统之上，通常会有一些编译和执行的虚拟机去做支撑。在以太坊里，有以太坊虚拟机EVM，可以执行任意复杂的算法代码。

开发者可以使用编程语言，通过以太坊虚拟机，可以简单地发行数字资产，编写智能合约，建立和运行去中心化的应用，成立去中心化自治组织等。

#### 燃料Gas

这些合约由我们称为“矿工”的参与方强制执行和证明。矿工其实是多台电脑，我们需要给矿工支付“gas”，它的运行一份合约的成本。当发布一份智能合约，或者执行一份智能合约，或者将资金转移到另一个账户上，就需要支付一些以太币用来转化成gas消耗。

























































